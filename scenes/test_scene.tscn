[gd_scene load_steps=31 format=3 uid="uid://bkj8x7vn5qr2p"]

[ext_resource type="PackedScene" uid="uid://cx8yp7qn2uqyg" path="res://scenes/player/player.tscn" id="1_player"]
[ext_resource type="Script" path="res://scripts/dimension_object.gd" id="2_dimobj"]
[ext_resource type="Script" path="res://scripts/dimension_environment.gd" id="3_dimenv"]
[ext_resource type="Shader" path="res://materials/shaders/dimension_transition.gdshader" id="4_shader"]
[ext_resource type="Script" path="res://scripts/dimension_transition_overlay.gd" id="5_overlay"]
[ext_resource type="PackedScene" uid="uid://dyh3m8v4n5qr8" path="res://scenes/ui/game_ui.tscn" id="6_gameui"]
[ext_resource type="Script" path="res://scripts/interactable.gd" id="7_interact"]
[ext_resource type="Script" path="res://scripts/nightmare_voices.gd" id="8_voices"]
[ext_resource type="Script" path="res://scripts/dimension_trigger.gd" id="9_trigger"]
[ext_resource type="Script" path="res://scripts/test_trigger_handler.gd" id="10_handler"]
[ext_resource type="Script" path="res://scripts/viking_choice_example.gd" id="11_viking"]
[ext_resource type="Script" path="res://scripts/dimension_ambient_audio.gd" id="12_ambient"]

[sub_resource type="BoxMesh" id="BoxMesh_floor"]
size = Vector3(20, 0.2, 20)

[sub_resource type="BoxShape3D" id="BoxShape3D_floor"]
size = Vector3(20, 0.2, 20)

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_normal"]
albedo_color = Color(0.8, 0.8, 0.8, 1)

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_viking"]
albedo_color = Color(0.2, 0.5, 0.9, 1)

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_aztec"]
albedo_color = Color(0.9, 0.7, 0.2, 1)

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_nightmare"]
albedo_color = Color(0.6, 0.1, 0.1, 1)

[sub_resource type="BoxMesh" id="BoxMesh_cube"]
size = Vector3(1, 1.5, 1)

[sub_resource type="BoxMesh" id="BoxMesh_pedestal"]
size = Vector3(1, 0.8, 1)

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_pedestal"]
albedo_color = Color(0.5, 0.5, 0.5, 1)

[sub_resource type="BoxShape3D" id="BoxShape3D_interact"]
size = Vector3(1.2, 1.2, 1.2)

[sub_resource type="BoxShape3D" id="BoxShape3D_trigger"]
size = Vector3(3, 3, 3)

[sub_resource type="CylinderMesh" id="CylinderMesh_shrine"]
top_radius = 0.4
bottom_radius = 0.5
height = 0.6

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_shrine"]
albedo_color = Color(0.3, 0.6, 0.8, 1)

[sub_resource type="BoxShape3D" id="BoxShape3D_shrine"]
size = Vector3(1, 1, 1)

[sub_resource type="BoxMesh" id="BoxMesh_wall"]
size = Vector3(8, 4, 0.5)

[sub_resource type="BoxShape3D" id="BoxShape3D_wall"]
size = Vector3(8, 4, 0.5)

[sub_resource type="ProceduralSkyMaterial" id="ProceduralSkyMaterial_normal"]
sky_top_color = Color(0.5, 0.7, 0.9, 1)
sky_horizon_color = Color(0.7, 0.8, 0.9, 1)
ground_horizon_color = Color(0.7, 0.8, 0.9, 1)

[sub_resource type="Sky" id="Sky_normal"]
sky_material = SubResource("ProceduralSkyMaterial_normal")

[sub_resource type="Environment" id="Environment_normal"]
background_mode = 2
sky = SubResource("Sky_normal")
tonemap_mode = 2
tonemap_exposure = 1.0
ambient_light_source = 3
ambient_light_color = Color(0.8, 0.8, 0.8, 1)
ambient_light_energy = 0.5
fog_enabled = true
fog_light_color = Color(0.7, 0.8, 0.9, 1)
fog_light_energy = 0.5
fog_density = 0.001

[sub_resource type="ProceduralSkyMaterial" id="ProceduralSkyMaterial_viking"]
sky_top_color = Color(0.1, 0.3, 0.6, 1)
sky_horizon_color = Color(0.3, 0.5, 0.7, 1)
ground_bottom_color = Color(0.15, 0.2, 0.3, 1)
ground_horizon_color = Color(0.3, 0.5, 0.7, 1)

[sub_resource type="Sky" id="Sky_viking"]
sky_material = SubResource("ProceduralSkyMaterial_viking")

[sub_resource type="Environment" id="Environment_viking"]
background_mode = 2
sky = SubResource("Sky_viking")
tonemap_mode = 2
tonemap_exposure = 0.85
ambient_light_source = 3
ambient_light_color = Color(0.4, 0.6, 0.9, 1)
ambient_light_energy = 0.6
fog_enabled = true
fog_light_color = Color(0.5, 0.7, 0.9, 1)
fog_light_energy = 0.8
fog_density = 0.003

[sub_resource type="ProceduralSkyMaterial" id="ProceduralSkyMaterial_aztec"]
sky_top_color = Color(0.9, 0.6, 0.2, 1)
sky_horizon_color = Color(0.95, 0.8, 0.4, 1)
ground_bottom_color = Color(0.6, 0.4, 0.2, 1)
ground_horizon_color = Color(0.95, 0.8, 0.4, 1)

[sub_resource type="Sky" id="Sky_aztec"]
sky_material = SubResource("ProceduralSkyMaterial_aztec")

[sub_resource type="Environment" id="Environment_aztec"]
background_mode = 2
sky = SubResource("Sky_aztec")
tonemap_mode = 2
tonemap_exposure = 1.15
ambient_light_source = 3
ambient_light_color = Color(0.95, 0.8, 0.5, 1)
ambient_light_energy = 0.7
fog_enabled = true
fog_light_color = Color(0.9, 0.75, 0.4, 1)
fog_light_energy = 0.6
fog_density = 0.002

[sub_resource type="ProceduralSkyMaterial" id="ProceduralSkyMaterial_nightmare"]
sky_top_color = Color(0.3, 0.05, 0.05, 1)
sky_horizon_color = Color(0.5, 0.1, 0.1, 1)
ground_bottom_color = Color(0.2, 0.02, 0.02, 1)
ground_horizon_color = Color(0.5, 0.1, 0.1, 1)

[sub_resource type="Sky" id="Sky_nightmare"]
sky_material = SubResource("ProceduralSkyMaterial_nightmare")

[sub_resource type="Environment" id="Environment_nightmare"]
background_mode = 2
sky = SubResource("Sky_nightmare")
tonemap_mode = 2
tonemap_exposure = 0.7
ambient_light_source = 3
ambient_light_color = Color(0.6, 0.2, 0.2, 1)
ambient_light_energy = 0.4
fog_enabled = true
fog_light_color = Color(0.5, 0.1, 0.1, 1)
fog_light_energy = 1.0
fog_density = 0.005

[node name="TestScene" type="Node3D"]

[node name="WorldEnvironment" type="WorldEnvironment" parent="."]
environment = SubResource("Environment_normal")

[node name="EnvironmentManager" type="Node" parent="."]
script = ExtResource("3_dimenv")
normal_environment = SubResource("Environment_normal")
viking_environment = SubResource("Environment_viking")
aztec_environment = SubResource("Environment_aztec")
nightmare_environment = SubResource("Environment_nightmare")

[node name="DirectionalLight3D" type="DirectionalLight3D" parent="."]
transform = Transform3D(0.866025, -0.433013, 0.25, 0, 0.5, 0.866025, -0.5, -0.75, 0.433013, 0, 10, 0)
shadow_enabled = true

[node name="Floor" type="StaticBody3D" parent="."]

[node name="MeshInstance3D" type="MeshInstance3D" parent="Floor"]
mesh = SubResource("BoxMesh_floor")
surface_material_override/0 = SubResource("StandardMaterial3D_normal")

[node name="CollisionShape3D" type="CollisionShape3D" parent="Floor"]
shape = SubResource("BoxShape3D_floor")

[node name="Statue" type="Node3D" parent="." node_paths=PackedStringArray("normal_mesh", "viking_mesh", "aztec_mesh", "nightmare_mesh")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.85, -5)
script = ExtResource("2_dimobj")
normal_mesh = NodePath("NormalCube")
viking_mesh = NodePath("VikingCube")
aztec_mesh = NodePath("AztecCube")
nightmare_mesh = NodePath("NightmareCube")

[node name="NormalCube" type="MeshInstance3D" parent="Statue"]
mesh = SubResource("BoxMesh_cube")
surface_material_override/0 = SubResource("StandardMaterial3D_normal")

[node name="VikingCube" type="MeshInstance3D" parent="Statue"]
visible = false
mesh = SubResource("BoxMesh_cube")
surface_material_override/0 = SubResource("StandardMaterial3D_viking")

[node name="AztecCube" type="MeshInstance3D" parent="Statue"]
visible = false
mesh = SubResource("BoxMesh_cube")
surface_material_override/0 = SubResource("StandardMaterial3D_aztec")

[node name="NightmareCube" type="MeshInstance3D" parent="Statue"]
visible = false
mesh = SubResource("BoxMesh_cube")
surface_material_override/0 = SubResource("StandardMaterial3D_nightmare")

[node name="VikingWall" type="StaticBody3D" parent="." node_paths=PackedStringArray("viking_mesh", "viking_collision")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 2, 0)
script = ExtResource("2_dimobj")
viking_mesh = NodePath("VikingWallMesh")
viking_collision = NodePath("VikingCollision")

[node name="VikingWallMesh" type="MeshInstance3D" parent="VikingWall"]
visible = false
mesh = SubResource("BoxMesh_wall")
surface_material_override/0 = SubResource("StandardMaterial3D_viking")

[node name="VikingCollision" type="CollisionShape3D" parent="VikingWall"]
shape = SubResource("BoxShape3D_wall")
disabled = true

[node name="Player" parent="." instance=ExtResource("1_player")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 5)

[node name="TransitionOverlay" type="CanvasLayer" parent="."]
layer = 100
script = ExtResource("5_overlay")
transition_shader = ExtResource("4_shader")

[node name="ColorRect" type="ColorRect" parent="TransitionOverlay"]
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
mouse_filter = 2

[node name="InteractablePedestal" type="StaticBody3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 3, 0.5, -3)
collision_layer = 2
collision_mask = 0
script = ExtResource("7_interact")
interaction_prompt = "Press E to examine the pedestal"
dialogue_text = "An ancient pedestal. You feel a strange energy emanating from it. Perhaps it holds secrets about the dimensions..."

[node name="MeshInstance3D" type="MeshInstance3D" parent="InteractablePedestal"]
mesh = SubResource("BoxMesh_pedestal")
surface_material_override/0 = SubResource("StandardMaterial3D_pedestal")

[node name="InteractionArea" type="Area3D" parent="InteractablePedestal"]
collision_layer = 2
collision_mask = 0

[node name="CollisionShape3D" type="CollisionShape3D" parent="InteractablePedestal/InteractionArea"]
shape = SubResource("BoxShape3D_interact")

[node name="GameUI" parent="." instance=ExtResource("6_gameui")]

[node name="AztecTrigger" type="Area3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -3, 1.5, -2)
script = ExtResource("9_trigger")
active_dimension = 2
debug_message = "You discovered the Aztec secret trigger!"

[node name="CollisionShape3D" type="CollisionShape3D" parent="AztecTrigger"]
shape = SubResource("BoxShape3D_trigger")

[node name="VikingShrine" type="StaticBody3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 5, 0.3, -3)
collision_layer = 2
collision_mask = 0
script = ExtResource("11_viking")
interaction_prompt = "Press E to honor the Viking spirits"
dialogue_text = ""
trust_amount = 10
choice_id = "viking_shrine_honored"
trust_message = "⚔️ The Viking spirits recognize your respect. ⚔️

+10 Viking Trust

The old ways are not forgotten."

[node name="MeshInstance3D" type="MeshInstance3D" parent="VikingShrine"]
mesh = SubResource("CylinderMesh_shrine")
surface_material_override/0 = SubResource("StandardMaterial3D_shrine")

[node name="InteractionArea" type="Area3D" parent="VikingShrine"]
collision_layer = 2
collision_mask = 0

[node name="CollisionShape3D" type="CollisionShape3D" parent="VikingShrine/InteractionArea"]
shape = SubResource("BoxShape3D_shrine")

[node name="TriggerHandler" type="Node" parent="." node_paths=PackedStringArray("trigger")]
script = ExtResource("10_handler")
trigger = NodePath("../AztecTrigger")
message = "✨ SECRET DISCOVERED! ✨

You found the hidden Aztec trigger! This area only exists when you're in the Aztec dimension. Try switching to other dimensions and walking through this spot - nothing will happen!"

[node name="NightmareVoices" type="Node" parent="."]
script = ExtResource("8_voices")
voice_lines = Array[String](["They're watching you...", "You don't belong here.", "Turn back while you still can.", "The shadows whisper your name...", "This dimension hungers...", "You feel eyes upon you from every corner.", "Something stirs in the darkness.", "Your presence disturbs the void.", "Time moves differently here...", "Do you hear them too?", "The darkness embraces you...", "Escape is an illusion.", "We've been expecting you."])
auto_dismiss_time = 4.0
show_on_every_entry = true

[node name="DimensionAmbientAudio" type="Node" parent="."]
script = ExtResource("12_ambient")
crossfade_duration = 2.0
silent_volume_db = -80.0
active_volume_db = 0.0
